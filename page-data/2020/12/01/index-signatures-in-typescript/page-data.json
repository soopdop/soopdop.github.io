{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020/12/01/index-signatures-in-typescript/","result":{"data":{"site":{"siteMetadata":{"title":"Harry Park's Blog"}},"markdownRemark":{"id":"c8cffdf9-ceab-5e2a-b90a-5e205ec17671","excerpt":"TypeScript는 JavaScript의 관점에서 벗어나지 못한 상태로 접했을 때 매우 이상하게 느껴질 때가 있다. 그 중 하나였던 index signatures에 대해 이해하기 쉬운 방향으로 설명하고자 한다. objectstring 접근을 허용하지 않는 TypeScript…","html":"<!-- 참고했던 문서\nhttps://itmining.tistory.com/87\nhttps://www.typescriptlang.org/docs/handbook/literal-types.html\nhttps://www.typescriptlang.org/docs/handbook/unions-and-intersections.html\nhttps://mariusschulz.com/blog/mapped-types-in-typescript\nhttps://skovy.dev/typescript-explained-in-javascript-mapped-types/\n--->\n<p>TypeScript는 JavaScript의 관점에서 벗어나지 못한 상태로 접했을 때 매우 이상하게 느껴질 때가 있다. 그 중 하나였던 index signatures에 대해 이해하기 쉬운 방향으로 설명하고자 한다.</p>\n<h5>object[string] 접근을 허용하지 않는 TypeScript</h5>\n<p>TypeScript에서는 기본적으로 <code class=\"language-text\">object[propertyName]</code>와 같이 프로퍼티의 값을 읽을 때 <code class=\"language-text\">object[string]</code>으로의 접근을 기본적으로 허용하지 않는다. JavaScript만을 다뤄왔다면 아래 코드가 컴파일 에러를 낸다는 사실에 충격을 먹을 수도 있겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">let</span> propertyName <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>propertyName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// error!</span></code></pre></div>\n<p>에러의 내용은 다음과 같다.</p>\n<blockquote>\n<p>Element implicitly has an ‘any’ type because expression of type ‘string’ can’t be used to index type ’{ foo: string; }‘. No index signature with a parameter of type ‘string’ was found on type ’{ foo: string; }‘.(7053)</p>\n</blockquote>\n<p>사실은 “허용하지 않는다”는 표현은 올바르지 않다. 마치 TypeScript가 이 상황을 막기위해 조금 예외적인 규칙을 두는 것처럼 들릴 수 있기 때문이다. 위 코드가 컴파일 에러를 내는 이유는 단지 <strong>“그 것이 TypeScript이기 때문”</strong> 이다.</p>\n<ul>\n<li>(소리가 들린다면 착각입니다.)\n<img src=\"/1f9ab002a2ace5d964c9bc7d0b1a03c8/dog-sound.gif\"></li>\n</ul>\n<p>말장난 처럼 느껴질 수도 있지만 TypeScript에서는 정해진 곳에 정해진 타입만 허용하는 것이 당연한 원칙이자 TypeScript를 사용하는 유일한 이유이다. 위 코드는 <code class=\"language-text\">string literal</code>만 허용되는 곳에 <code class=\"language-text\">string</code>을 이용했기 때문에 것이다. 이 말이 무슨 뜻인지 쉽고 편안하게 이해할 수 있도록 설명하고자 하는 것이 이 포스트의 목표이다.</p>\n<h5>string 타입과 string literal 타입은 다르다</h5>\n<p>다음과 같은 TypeScript 코드가 있다. <code class=\"language-text\">helloWorld2</code>와 <code class=\"language-text\">hellowWorld3</code>은 string 타입이 맞지만, <code class=\"language-text\">hellowWorld1</code>은 이상하게도 strig 타입이 아닌 <code class=\"language-text\">&quot;Hello World&quot;</code> 타입이다. <a href=\"https://www.typescriptlang.org/play?#code/MYewdgzgLgBAFgUwDZJAdRAJyQEwIwwC8MARABLKowbY4kCwAUEgrIiulrgExGkUdqXOk1CQ2lTrQDMALhjRMASzABzPuUlDaJIA\">Type Script Playground</a>에서 각 변수명에 mouse over하면 타입을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> helloWorld1 <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span>\n<span class=\"token keyword\">let</span> helloWorld2 <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span>\n<span class=\"token keyword\">const</span> helloWorld3<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">hellowWorld2</code> 변수는 <code class=\"language-text\">let</code>으로 선언되어 재할당될 수 있을 경우 어떤 문자열이든 넣을 수 있으며 그 경우의 수가 무한대이다. 그렇기 때문에 컴파일러는 이 변수를 string 타입으로 추론한다.</li>\n<li><code class=\"language-text\">hellowWorld3</code> 변수는 명시적으로 string 타입으로 선언했으므로 그냥 string 타입이다.</li>\n<li>하지만 <code class=\"language-text\">helloWorld1</code>의 경우, 컴파일러는 이 변수를 <code class=\"language-text\">string</code>이 아닌 조금 더 좁은 타입(narrowed type)으로 선언한 것으로 추론한다. 이 것을 <a href=\"https://www.typescriptlang.org/docs/handbook/literal-types.html#literal-narrowing\">Literal Narrowing</a>이라고 한다. (참고로 <a href=\"https://www.typescriptlang.org/docs/handbook/type-inference.html\">타입 추론</a>은 TypeScript 컴파일러가 제공하는 뛰어난 기능 중 하나이며, 개발자가 명시적으로 타입을 선언해 주지 않을 경우 컴파일러가 할당되는 값을 기준으로 타입을 스스로 결정하는 것을 말한다.)</li>\n</ul>\n<p><code class=\"language-text\">helloWorld1</code>의 타입은 string타입이 아니라 string타입을 좁혀 만든 <a href=\"https://www.typescriptlang.org/docs/handbook/literal-types.html\">literal type</a>이다. 좁힌다는 말을 조금 더 풀어 보자면, 무한대의 경우의 수를 가질 수 있는 string타입보다 훨씬 구체적인 string의 부분집합, <code class=\"language-text\">&quot;Hello World&quot;</code>만을 허용하는 타입이다.</p>\n<p>따라서 아래와 같이 명시적으로 literal type을 선언하면 <code class=\"language-text\">let</code>으로 선언된 변수도 <code class=\"language-text\">&quot;Hellow World&quot;</code> 타입만을 허용하도록 만들 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">HelloWorldType</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span> <span class=\"token comment\">// literal type</span>\n\n<span class=\"token class-name\"><span class=\"token keyword\">let</span></span> helloWorld<span class=\"token operator\">:</span> HelloWorldType <span class=\"token operator\">=</span> <span class=\"token string\">\"Hello World\"</span> <span class=\"token comment\">// ok</span>\n<span class=\"token keyword\">let</span> helloWorld <span class=\"token operator\">=</span> <span class=\"token string\">\"hahaha\"</span> <span class=\"token comment\">// compile error: \"hahaha\"는 \"Hello World\"가 아니기 때문.</span></code></pre></div>\n<h5>string literal 타입은 언제 유용하게 사용될 수 있을까?</h5>\n<p>타입스크립트의 공식 문서에서도 볼 수 있지만, String literal 타입은 열거형 타입처럼 사용할 때 매우 유용하다. 예를 들어 이벤트 핸들러를 등록할 수 있는 함수가 있다고 하면 이벤트의 종류는 이미 정해져 있을 것이다. JavaScript에서 사용하던 방법대로 이벤트 이름을 <code class=\"language-text\">string</code> 타입으로 받아도 되지만, 개발자의 오타나 유효하지 않은 이벤트 이름으로 인해 발생하는 런타임에러를 방지할 수 없다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> handler<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"clock\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 오타. 컴파일 타임에 발견할 수 없음.</span>\n<span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hover\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 유효하지 않은 이벤트 이름. 하지만 컴파일 타임에 걸러낼 수 없음.</span></code></pre></div>\n<p>다음과 같이 정해진 이벤트의 종류에 해당하는 몇 개의 literal 타입들의 조합만을 허용하도록 하도록 수정한다. 여기서 <code class=\"language-text\">|</code>은 <a href=\"https://www.typescriptlang.org/docs/handbook/unions-and-intersections.html\">union type</a>을 의미하며 두 개의 타입 이상을 결합할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">EventType</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"mouseout\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"mouseover\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"click\"</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> EventType<span class=\"token punctuation\">,</span> handler<span class=\"token operator\">:</span> <span class=\"token builtin\">Function</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">registerEventHandler</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hover\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// compile error! Argument of type '\"hover\"' is not assignable to parameter of type 'EventType'.</span></code></pre></div>\n<p>이렇게 string literal 타입을 활용하면 <code class=\"language-text\">&quot;clock&quot;</code>과 어이 없는 오타를 컴파일 타임에 알 수 있으며, IDE에서 제공하는 suggestion 기능(ctrl + space) 편리함을 누릴 수도 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAckWQH//xAAWEAADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQEAAQUCFX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAACAwAAAAAAAAAAAAAAAAABEQAQMf/aAAgBAQABPyE2kO1//9oADAMBAAIAAwAAABCAD//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/EGf/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAn/8QAGRABAAMBAQAAAAAAAAAAAAAAAQARYTFR/9oACAEBAAE/EGJVTk6Gyjyf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"suggestion\"\n        title=\"suggestion\"\n        src=\"/static/766be75568ecc4766ff9fb4ce17bb083/828fb/suggestion.jpg\"\n        srcset=\"/static/766be75568ecc4766ff9fb4ce17bb083/ff44c/suggestion.jpg 158w,\n/static/766be75568ecc4766ff9fb4ce17bb083/a6688/suggestion.jpg 315w,\n/static/766be75568ecc4766ff9fb4ce17bb083/828fb/suggestion.jpg 630w,\n/static/766be75568ecc4766ff9fb4ce17bb083/30e56/suggestion.jpg 679w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h5>Object[literal 타입]으로 접근해 보자</h5>\n<p>이제 literal 타입이 무엇인지 알았으니, <code class=\"language-text\">Object</code>의 접근을 위한 index로 사용해 본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> propertyName <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>propertyName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ok!</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ok!</span></code></pre></div>\n<p>이제 문제 없이 동작한다. string 타입으로 object에 접근하지 못하는 것은 여러모로 불편하다. 함수의 파라미터의 하나로 <code class=\"language-text\">key:string</code>을 받는 경우, 서버로부터 받은 데이터를 string타입으로 저장했을 경우가 있을 수 있다. 또 다른 예는 Object.keys()에서 리턴되는 값은 <code class=\"language-text\">string[]</code>이기 때문에 다음과 같은 코드를 그대로 사용한다면 컴파일 에러가 발생한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// error! key가 string타입이다.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 예제는 <a href=\"https://www.typescriptlang.org/docs/handbook/basic-types.html#type-assertions\">Type assertions</a>을 이용하여 해결할 수도 있다. 하지만 근본 원인은 string타입으로 <code class=\"language-text\">obj</code>에 접근하려고 한 것으로 TypeScript를 처음 접하는 사람을 어리둥절하게 만드는 것 중 하나이다.</p>\n<h5>index signature를 string 타입으로 선언하자</h5>\n<p>이 포스트의 도입부에 언급된 문제를 없애려면 string 타입의 index로 object에 접근하도록 만들어야 한다. 그 것을 가능하게 하기 위해서는 <code class=\"language-text\">[index:string]:string</code>으로 index signature를 선언해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">ObjType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>index<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  bar<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> obj<span class=\"token operator\">:</span> ObjType <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span>\n  bar<span class=\"token operator\">:</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> propertyName1 <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span>\n<span class=\"token keyword\">const</span> propertyName2<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"foo\"</span>\n\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>propertyName1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ok</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span>propertyName2<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ok</span></code></pre></div>\n<p>참고로 위에서 사용된 이름인 <code class=\"language-text\">index</code>는 정해진 키워드가 아니라 개발자가 의미에 맞게 마음대로 쓸 수 있다.</p>\n<p>드디어 string타입과 literal type 모두를 사용해서 <code class=\"language-text\">obj</code>에 접근할 수 있게 되었다. 위처럼 index signature가 선언된 경우 모든 맴버가 그 것에 따라야 한다. 그렇지 않으면 다음과 같이 에러가 발생한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">ObjType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  foo<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  bar<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token comment\">// error! Property 'bar' of type 'number' is not assignable to string index type 'string'.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>number 타입의 index signature을 선언하면 배열 처럼 사용할 수 있다</h5>\n<p>index signture의 number 타입으로 선언하면 다음과 같이 배열 모양처럼 사용할 수도 있다. 심지어 string과 number 타입 둘다 가지는 것도 허용하나 예제는 생략한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">ArrayLikeType</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> obj<span class=\"token operator\">:</span> ArrayLikeType <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> obj<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// \"hello\" \"world\"</span></code></pre></div>\n<h5>string대신 narrowed 타입으로 index signature를 선언할 수 있을까?</h5>\n<p>이제 무한의 경우의 수를 가진 string 타입 대신 string literal type을 union한 narrowing 타입을 사용할 수 있는지 테스트 해본다. 사실 이 것은 프로퍼티 이름을 직접 나열한 것과 아무 차이가 없다. 하지만 가능한지의 여부와 쓸모 있는지의 여부는 별개이기 때문에 테스트해 본다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">AllowedKeys</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"world\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ObjType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key<span class=\"token operator\">:</span> AllowedKeys<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token comment\">// error!</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 전혀 문제가 없는 것처럼 느껴지는 위 코드는 컴파일 에러를 내뿜는다.</p>\n<blockquote>\n<p>An index signature parameter type cannot be a union type. Consider using a mapped object type instead.</p>\n</blockquote>\n<p>에러의 내용을 보면 index signature 타입으로 union type은 사용할 수 없으며 mapped object type을 사용하라 한다. index signature의 타입으로는 string, number 등만 정해진 타입만 사용이 가능하다.</p>\n<h5>mapped type 이용하면 구현이 가능하다. 하지만…</h5>\n<p>이미 선언된 타입의 프로퍼티에 어떤 조작을 가하여 새로운 타입을 만드는 것을 <a href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types\">mapped types</a>라 한다. 프로퍼티를 빼거나 추가할 수 있고, optional 혹은 readonly 상태로 바꿀 수 도 있어서 매우 유용하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">AllowedKeys</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"world\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ObjType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>key <span class=\"token keyword\">in</span> AllowedKeys<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token comment\">// ok!</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 하면 문제 없이 컴파일 된다. 이 것이 mapped type을 선언하는데 사용하는 전형적인 코드이며 이 때 사용하는 <code class=\"language-text\">in</code> 키워드가 조금 혼란스러울 수 있다. 그 이유는 객체 안에 특정 프로퍼티가 있는지 체크하기 위한 <code class=\"language-text\">in</code> operator가 전혀 다른 용도로 존재하기 때문이다.</p>\n<p>따라서 mapped type에서의 <code class=\"language-text\">in</code>은 <code class=\"language-text\">for...in</code>의 축약형이라고 생각하는 것이 이해하고 기억하는데 훨씬 도움이 될 것이다. 즉, <code class=\"language-text\">AllowedKeys</code>의 각각의 요소를 하나씩 가져오고 그 것을 이용해 새로운 프로퍼티들을 만드는 과정으로 이해해야 한다. 이렇게 만들어진 결과는 사실 다음의 선언과 완전히 동일하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">ObjType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  hello<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  world<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 mapped type은 index signatures와 관련이 없으므로 이 포스트의 주제와는 동떨어진 예제가 되어 버렸다. 그리고 다음과 같이 섞어서 사용하는 것도 불가능했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">AllowedKeys</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"world\"</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ObjType</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>index<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  <span class=\"token punctuation\">[</span>key <span class=\"token keyword\">in</span> AllowedKeys<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token comment\">// compile error!</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>끝.</p>\n<!--\n##### 조금 더 실용적인 예제로 마무리\n\n![](./finish.jpg)\n\nTypeScript 공식 사이트에 나온 설명은 깔끔하고 군더더기 없다. 그렇기에 각 기능들이 조합되어 있거나 실용적인 예제를 보여주지 못한다는 단점이 있다. 이 포스트에서는 조금 더 실용적으로 보이는 예제로 마무리를 해보려고 한다.\n\n- 어떤 과일가게에 들여오는 정해진 과일 목록이 있고, 그 것의 가격을 나타내는 object를 만들려고 한다.\n- 과일 목록은 다른 코드에서도 사용하므로 재사용가능하게 만들어야 한다.\n- 정해진 과일 뿐만 아니라 간혹 새로운 과일이 들어올 수 있으므로 목록에 없는 이름도 추가할 수 있도록 한다.\n\n```\nenum Fruit {\n    Apple,\n\n}\n\n``` -->","frontmatter":{"title":"TypeScript의 index signatures 쉽게 설명하기","date":"December 01, 2020","description":null}},"previous":{"fields":{"slug":"/2020/11/26/add-categories-to-gatsby/"},"frontmatter":{"title":"Gatsby Blog에 category 기능을 추가하자"}},"next":{"fields":{"slug":"/2020/12/03/rest-and-spread-in-javascript/"},"frontmatter":{"title":"JavaScript(ES6)의 Spread 와 Rest 쉽게 설명하기"}}},"pageContext":{"id":"c8cffdf9-ceab-5e2a-b90a-5e205ec17671","previousPostId":"fea10397-e69c-5175-9cd0-f54f9a0fcc5d","nextPostId":"30de7482-a78d-5a0a-a516-c6f923b80e7a"}},"staticQueryHashes":["2841359383","916993862"]}